<!DOCTYPE html>
<html>
    <head>

        <style type="text/css">
            .active {color:red}
        </style>
        
        <script type="module">
            import {TimingObject, Dataset, Sequencer, Interval} from "https://webtiming.github.io/timingsrc/lib/timingsrc-v3.js";

            /*
                Create TimingObject, Dataset and Sequencer
            */
            const to = new TimingObject();
            const ds = new Dataset();
            const activeCues = new Sequencer(ds, to);

            /*
                Visualize Timing Object Position
            */
            const pos_elem = document.getElementById("position");
            to.on("timeupdate", function() {
                pos_elem.innerHTML = `${to.pos.toFixed(2)}`;
            });

            /*
                Connect buttons        
            */
            document.getElementById("play").onclick = function () {
                to.update({velocity:1});
            };
            document.getElementById("pause").onclick = function () {
                to.update({velocity:0});
            };
            document.getElementById("reverse").onclick = function () {
                to.update({velocity:-1});
            };
            document.getElementById("reset").onclick = function () {
                to.update({position:0, velocity:0});
            };

            /*
                Mockup Timed Data
            */
            const data = [
                {id:"a", text: 'A', start: 0, end: 1 },
                {id:"b", text: 'B', start: 2, end: 3 },
                {id:"c", text: 'C', start: 4, end: 5 },
                {id:"d", text: 'D', start: 6, end: 7 },
                {id:"e", text: 'E', start: 8, end: 9 },
                {id:"f", text: 'F', start: 10, end: 11 },
                {id:"g", text: 'G', start: 12, end: 13 },
                {id:"h", text: 'H', start: 14, end: 15 },
                {id:"i", text: 'I', start: 16, end: 17 },
                {id:"j", text: 'J', start: 18, end: 19 },
                {id:"k", text: 'K', start: 20, end: 21 },
                {id:"l", text: 'L', start: 22, end: 23 },
                {id:"m", text: 'M', start: 24, end: 25 },
                {id:"n", text: 'N', start: 26, end: 27 },
                {id:"o", text: 'O', start: 28, end: 29 },
                {id:"p", text: 'P', start: 30, end: 31 },
                {id:"q", text: 'Q', start: 32, end: 33 },
                {id:"r", text: 'R', start: 34, end: 35 },
                {id:"s", text: 'S', start: 36, end: 37 },
                {id:"t", text: 'T', start: 38, end: 39 },
                {id:"u", text: 'U', start: 40, end: 41 },
                {id:"v", text: 'V', start: 42, end: 43 },
                {id:"w", text: 'W', start: 44, end: 45 },
                {id:"x", text: 'X', start: 46, end: 47 },
                {id:"y", text: 'Y', start: 48, end: 49 },
                {id:"z", text: 'Z', start: 50, end: 51 } 
            ];

            /*
                Load timed cues into dataset
            */
            const cues = data.map(item => {
                return {
                    key: item.id,
                    interval: new Interval(item.start, item.end),
                    data: item
                };
            });
            ds.update(cues);

            /*
                Visualize cues in dataset
            */
            let html = [...ds.values()]
                .map(function(cue){
                    let key = cue.key;
                    let text = JSON.stringify(cue.data);
                    if (activeCues.has(cue.key)) {
                        return `<div id=${key} class="active">${text}</div>`;
                    } else {
                        return `<div id=${key}>${text}</div>`;
                    }
                })
                .join("\n");
            document.getElementById("cues").innerHTML = html;

            /*
                Visualize active cues
            */
            activeCues.on("change", (eArg, eInfo) => {
                let el = document.getElementById(eArg.key);
                if (el) {
                    el.classList.add("active");
                }
            });

            activeCues.on("remove", (eArg, eInfo) => {
                let el = document.getElementById(eArg.key);
                if (el) {
                    el.classList.remove("active");
                }
            });

        </script>

    </head>
    <body>
        <div>
            Timing Object Position: <span id="position"></span>
        </div>
        <div>
            <button id="play">Play</button>
            <button id="pause">Pause</button>
            <button id="reverse">Reverse</button>
            <button id="reset">Reset</button>
        </div>
        <p>
          <div id="cues"></div>
        </p>
    </body>
</html>
